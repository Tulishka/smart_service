{% extends "base.html" %}

{% block content %}

<form action="codes_process" method="POST">
  <div class="container">
    <div class="d-flex justify-content-between mb-3">
    <ul class="nav nav-underline">
    <li class="nav-item">
      <a class="nav-link active disabled">Асеты</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="{{ url_for('assets.types') }}">Виды асетов</a>
    </li>
    </ul>
    <button id="print_qr_codes" class="btn btn-sm btn-secondary sticky d-none" type="submit">Печать QR</button>
  </div>
  <table id="data" class="table">
    <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Адрес</th>
      <th scope="col">Вид
        <select id="types">
          <option value="all" selected>ВСЕ ВИДЫ</option>
          {% for type in types %}
            <option value="{{ type }}">{{ type }}</option>
          {% endfor %}
        </select>
      </th>
      <th scope="col">Название</th>
      <th scope="col">Статус
        <select id="status">
          <option value="all" selected>ЛЮБОЙ СТАТУС</option>
          <option value="ДОСТУПНО">ДОСТУПНО</option>
          <option value="НЕ ДОСТУПНО">НЕ ДОСТУПНО</option>
          <option value="НА ОБСЛУЖИВАНИИ">НА ОБСЛУЖИВАНИИ</option>
        </select>
      </th>
      <th scope="col" class="text-center">Выбор</th>
    </tr>
    </thead>
    <tbody>
    <tr onclick="location='{{ url_for('assets.edit', asset_id=0) }}'">
      <td id="create-new-in-list-btn" colspan="6">
        + Добавить новый асет
      </td>
    </tr>
    {% for asset in assets %}
    <tr class="asset-row" data-type="{{ asset.type.name }}" data-status="{{ asset.status.value }}" onclick="location='{{ url_for('assets.edit', asset_id=asset.id) }}'">
      <td scope="row">{{ loop.index }}</td>
      <td>{{ asset.address }}</td>
      <td>{{ asset.type.name }}</td>
      <td>{{ asset.name }}</td>
      <td>{{ asset.status.value }}</td>
      <td class="text-center" onclick="event.stopPropagation()" onchange="print_checkbox_change()"><input type="checkbox" name="checkboxes" value="{{ asset.id }}"></td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
</form>

  <script>
        function print_checkbox_change() {
            let checked = Array.from(document.querySelectorAll('input[name=checkboxes]').values())
                .filter(x=>x.checked).map(x=>x.value);
            const button = document.getElementById('print_qr_codes');
            button.classList.toggle('d-none',checked.length===0);
        }
  </script>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const typesSelect = document.getElementById('types');
    const statusSelect = document.getElementById('status');
    const rows = document.querySelectorAll('.asset-row');

    function filterRows() {
      const selectedType = typesSelect.value;
      const selectedStatus = statusSelect.value;

      rows.forEach(row => {
        const rowType = row.getAttribute('data-type');
        const rowStatus = row.getAttribute('data-status');

        const typeMatch = selectedType === 'all' || rowType === selectedType;
        const statusMatch = selectedStatus === 'all' || rowStatus === selectedStatus;

        if (typeMatch && statusMatch) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    typesSelect.addEventListener('change', filterRows);
    statusSelect.addEventListener('change', filterRows);
  });
  </script>

{% endblock %}
